import{_ as Q}from"./Modal-d90e4256.js";import{_ as X}from"./Spinner-244d9358.js";import{_ as ee}from"./TimeAgo-d7658970.js";import{A as c,a4 as ne,c as I,aa as te,K as s,U as oe,a0 as v,G as o,a1 as D,J as r,F as a,C as S,D as U,H as V,B as i,Q as q,R as E,T as _,S as A,W as B,$ as ae}from"./iconify-4eda29ca.js";import{P as f,W as se}from"./vue3-tabs-component-2945cbbd.js";import{r as ie}from"./index-b7a54f6a.js";import"./_plugin-vue_export-helper-c27b6911.js";const le={class:"p-5 bg-base-200 max-h-full"},re=o("h3",null,"Invitar al equipo",-1),ce=["onSubmit"],de={class:"min-h-[200px]"},ue={class:"overflow-y-auto max-h-[calc(100vh-480px)] md:max-h-[calc(100vh-420px)] shadow"},ve={key:0,class:"table w-full bg-base-100 rounded-none"},he={class:"divide-y"},me={key:0,class:"uppercase p-1"},pe={key:1,class:"btn bg-base-100 border-none pointer-events-none"},_e={key:2,class:"btn bg-base-100 border-none pointer-events-none"},be=["onClick"],ge=["onClick"],fe={key:1,class:"p-2 bg-base-100"},ye={class:"min-h-[200px]"},ke={class:"overflow-y-auto max-h-[calc(100vh-480px)] md:max-h-[calc(100vh-420px)] mt-3"},xe={key:0,class:"table w-full bg-base-100 shadow"},$e={class:"divide-y"},we=["onClick"],Ce=["onClick"],Ie={key:1,class:"p-1"},Se=o("p",null,"A las personas que no disponen de cuenta en tseyor.org puedes invitarlas por correo.",-1),qe=o("small",null,"Escribe las direcciones de correo separadas por comas, por espacios, o en cada línea.",-1),Ee={key:0},Ae={key:1,class:"table w-full bg-base-100 shadow"},Be=o("thead",null,[o("th",null,"Fecha"),o("th",null,"Usuario/correo"),o("th",null,"Estado")],-1),Ne={class:"py-3 flex justify-between sm:justify-end gap-5"},Re=["disabled"],Me={key:0},je={__name:"ModalInvitaciones",props:{equipo:{type:Object,required:!0}},setup(z,{expose:P}){const y=z;P({mostrar:F});const b=c(!1),h=c(""),k=c([]),l=c([]),d=c(""),N=ie(d,800);ne(N,T);const m=I(()=>h.value.split(/[\s,\n]+/m).map(n=>n.trim()).filter(n=>!!n).filter(n=>n.match(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/))),x=I(()=>l.value.length+m.value.length),p=c(!1);function F(){d.value="",b.value=!0}function T(){const n=N.value.trim();n.length>=3?axios.get(route("usuarios.buscar",n)).then(e=>{console.log("response",e.data),k.value=e.data}).catch(e=>{console.error(e)}):k.value=[]}const R=I(()=>k.value.map(n=>({...n,agregado:!!l.value.find(e=>e.id==n.id),miembro:y.equipo.miembros.find(e=>e.id==n.id)?1:0,invitacion:u.value.find(e=>e.user_id==n.id&&!e.accepted_at&&!e.declined_at)})).sort((n,e)=>n.miembro-e.miembro)),u=c([]);function M(){axios.get(route("equipo.invitaciones",y.equipo.id)).then(n=>{u.value=n.data.invitaciones,console.log(n.data)})}M();function $(n){l.value.push({...n,invitacion:!0})}function j(n){const e=l.value.findIndex(g=>g.id==n.id);e>-1&&l.value.splice(e,1)}function W(n){return n==1?"Se ha mandado":"Se han mandado"}function Z(n){return n==1?"invitación":"invitaciones"}function w(n){return n==1?"usuario":"usuarios"}function H(n){return n==1?"ya es miembro":"ya son miembros"}function Y(n){return n==1?"ya tiene":"ya tienen"}function G(n){return n==1?"existe":"existen"}function J(){p.value=!0,axios.post(route("invitar",{idEquipo:y.equipo.id}),{correos:m.value,usuarios:l.value.map(n=>n.id)}).then(n=>{const e=n.data;alert((e.invitados.length?`${W(e.invitados.length)} ${e.invitados.length} ${Z(e.invitados.length)}`:"No se han mandado las invitaciones")+`
`+(e.yaSonMiembros.length?`${e.yaSonMiembros.length} ${w(e.yaSonMiembros.length)} ${H(e.yaSonMiembros.length)} del equipo
`:"")+(e.invitacionReciente.length?`${e.invitacionReciente.length} ${w(e.invitacionReciente.length)} ${Y(e.invitacionReciente.length)} una invitación reciente
`:"")+(e.noEncontrados.length?`${e.noEncontrados.length} ${w(e.noEncontrados.length)} no ${G(e.noEncontrados.length)}
`:"")),h.value="",m.value=[],l.value=[],M(),p.value=!1,console.log(n.data)}).catch(n=>{switch(n.response.status){case 403:alert("No estás autorizado");break;case 404:case 410:alert("Error interno. El equipo no existe");break;default:alert("Hubo un error, no se pudo mandar las invitaciones.")}console.error(response),p.value=!1})}return(n,e)=>{const g=te("Icon"),K=ee,L=X,O=Q;return s(),oe(O,{show:a(b),onClose:e[3]||(e[3]=t=>b.value=!1),maxWidth:"xl"},{default:v(()=>[o("div",le,[re,o("form",{onSubmit:D(J,["prevent"]),class:"flex flex-col gap-7 select-none"},[r(a(se),{options:{disableScrollBehavior:!0,useUrlFragment:!1}},{default:v(()=>[r(a(f),{name:"Buscar usuarios"},{default:v(()=>[o("div",de,[S(o("input",{type:"search",class:"input shadow flex-shrink-0 rounded-none border-b border-gray-500",placeholder:"Buscar usuario...","onUpdate:modelValue":e[0]||(e[0]=t=>V(d)?d.value=t:null)},null,512),[[U,a(d)]]),o("div",ue,[a(R).length?(s(),i("table",ve,[o("tbody",he,[(s(!0),i(q,null,E(a(R),t=>(s(),i("tr",{key:t.id},[o("td",null,_(t.nombre),1),o("td",null,[t.miembro?(s(),i("div",me,"Ya es miembro ")):t.agregado?(s(),i("div",pe,[r(g,{icon:"ph:check-circle-duotone"}),A(" Agregado ")])):t.invitacion?(s(),i("div",_e,[r(g,{icon:"ph:check-circle-info"}),A(" Ya invitado ")])):(s(),i("div",{key:3,class:"btn",onClick:C=>$(t)}," Agregar ",8,be)),!t.agregado&&t.invitacion&&new Date-new Date(t.invitacion.created_at)>2028e5?(s(),i("div",{key:4,class:"btn",onClick:C=>$(t)}," Reenviar ",8,ge)):B("",!0)])]))),128))])])):a(d)?(s(),i("div",fe," No hay resultados ")):B("",!0)])])]),_:1}),r(a(f),{name:`Invitados ${a(l).length?"("+a(l).length+")":""}`},{default:v(()=>[o("div",ye,[o("div",ke,[a(l).length?(s(),i("table",xe,[o("tbody",$e,[(s(!0),i(q,null,E(a(l),t=>(s(),i("tr",{key:t.id},[o("td",null,_(t.nombre),1),o("td",null,[t.invitacion?(s(),i("div",{key:0,class:"btn",onClick:C=>j(t)}," Remover ",8,we)):(s(),i("div",{key:1,class:"btn",onClick:C=>$(t)}," Agregar ",8,Ce))])]))),128))])])):(s(),i("div",Ie," Ningún usuario agregado a la invitación. "))])])]),_:1},8,["name"]),r(a(f),{name:`Correos ${a(m).length?"("+a(m).length+")":""}`},{default:v(()=>[Se,o("div",null,[S(o("textarea",{class:"w-full","onUpdate:modelValue":e[1]||(e[1]=t=>V(h)?h.value=t:null),placeholder:"correo1@gmail.com, correo2@yahoo.es, ..."},null,512),[[U,a(h)]]),qe])]),_:1},8,["name"]),r(a(f),{name:`Invitaciones pendientes ${a(u).length?"("+a(u).length+")":""}`},{default:v(()=>[a(u).length?(s(),i("table",Ae,[Be,o("tbody",null,[(s(!0),i(q,null,E(a(u),t=>(s(),i("tr",{key:t.id},[o("td",null,[r(K,{date:t.created_at},null,8,["date"])]),o("td",null,_(t.user?t.user.name:t.email),1),o("td",null,_(!t.accepted_at&&!t.declined_at?"Pendiente":t.accepted_at?"Aceptada":"Rechazada"),1)]))),128))])])):(s(),i("p",Ee," No hay invitaciones pendientes"))]),_:1},8,["name"])]),_:1}),o("div",Ne,[o("button",{type:"submit",class:"btn btn-primary",disabled:a(p)||!a(x)},[S(r(L,{class:"mr-3"},null,512),[[ae,a(p)]]),A(" Invitar "),a(x)?(s(),i("span",Me,"("+_(a(x))+")",1)):B("",!0)],8,Re),o("button",{onClick:e[2]||(e[2]=D(t=>b.value=!1,["prevent"])),type:"button",class:"btn btn-neutral"}," Cancelar ")])],40,ce)])]),_:1},8,["show"])}}};export{je as default};
