import{A as u,c as h,a5 as k,af as W,K as j,U as q,a2 as C,F as g,a9 as M,V as P,ab as U}from"./iconify-4eda29ca.js";const B=e=>!e||e.match(/^https?:\/\//)?e:((e.match(/^\/?archivos/)||e.match(/^\/?almacen/)?"":"/almacen/")+e).replace(/\/\//g,"/"),x=["f1.jpg","f2.jpg","f3.jpg","f4.jpg"],D="/almacen/medios/imagenes_contenidos_por_defecto",F=(e,t)=>{if(!t){const r=Math.floor(Math.random()*x.length);t=D+"/"+x[r]}return e?B(e):t},p={},H=async function(e){return console.log("getImageSize",e),e=e.replace(/^https?:\/\/[^/]+/,""),new Promise(async(t,r)=>p[e]?t(p[e]):(console.log("fetch image.tamaÃ±o",e),await fetch("/image_size?url="+e).then(async s=>{console.log("fetch respuesta",e,s);const i=await s.json();return console.log({data:i}),p[e]=i,t(i)}).catch(()=>r())))};function N(){var e=document.createElement("canvas");return e.getContext&&e.getContext("2d")?e.toDataURL("image/webp").indexOf("data:image/webp")==0:!1}var f=null;const E=async()=>new Promise(async(e,t)=>{f!==null&&e(f),f=N(),e(f)}),A={__name:"Image",props:{src:{type:String,required:!0},fallback:{type:String,required:!1},width:{type:[Number,String],required:!1},height:{type:[Number,String],required:!1},srcWidth:{type:[Number,String],required:!1,default:null},srcHeight:{type:[Number,String],required:!1,default:null},alt:{type:String},title:{type:String},optimize:{type:Boolean,default:!0}},setup(e){const t=e,r=u(),s=h(()=>window==null?void 0:window.location.origin),i=h(()=>F(t.src,t.fallback)),d=u(!1),y=u(!1);function w(a){let n="px";return typeof a=="string"&&a.match(/\d+\D+/)&&(n=""),a+n}const I=h(()=>{const a={};return t.width&&(a.width=w(t.width)),t.height&&(a.height=w(t.height)),a});function v(a){return typeof a=="number"?a:parseInt(a)}const c=u("");function _(){var a;if(console.log("Image.init",t.src,"props.width:",t.width,"props.height:",t.height),((a=t.src.match(/https?:\/\/[^/]+/))==null?void 0:a[0])===s.value||!t.optimize||t.src.match(/\?[wh]=/))return o(i.value);if(t.width&&t.height)return S(t.width,t.height);if(t.srcWidth&&t.srcHeight)return m(v(t.srcWidth),v(t.srcHeight));H(i.value).then(n=>{m(n.width,n.height)}).catch(n=>{console.error(n),o(i.value)})}var l={width:0,height:0};function m(a,n){l.width=a,l.height=n,c.value=`data:image/svg+xml,%3Csvg width="${a}" height="${n}" xmlns="http://www.w3.org/2000/svg"%3E%3C/svg%3E`,setTimeout(()=>{d.value?S(r.value.offsetWidth,r.value.offsetHeight):m(a,n)},50)}async function S(a,n){if(console.log("putImageWithSize",i.value,a,n),a==l.width&&n==l.height)return o(i.value);const z=await E();var b=i.value+"?w="+Math.round(parseFloat(a))+"&h="+Math.round(parseFloat(n));z||(b+="&fmt=jpg"),o(b)}function o(a){c.value=a,U(()=>{r.value.setAttribute("loading","lazy"),r.value.onload=()=>{y.value=!0}})}return k(()=>{console.log(`image mounted: ${t.src}`),d.value=!0}),_(),W(()=>{}),(a,n)=>(j(),q(P(g(c)?"img":"div"),{ref_key:"img",ref:r,class:C(["is-image transition-opacity duration-200",g(y)?"opacity-100":"opacity-0"]),src:g(c),alt:e.alt,title:e.title,style:M(g(I))},null,8,["src","alt","title","class","style"]))}};export{A as _,F as a,B as g};
